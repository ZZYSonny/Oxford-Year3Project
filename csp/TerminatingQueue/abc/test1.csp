include "../common.csp"
include "correct1.csp"
include "queue.csp"
include "lin.csp"

channel wrongInputFormat
channel queueShutting

Spec1Thread=Linearizers({T1})
Spec2Thread=Linearizers({T1,T2})
assert Spec2Thread [T= Spec2Thread

Thread(me)=
  (|~|x:TypeData @ 
    enqueue(me,x);Thread(me)
  ) |~| (
    dequeue(me);Thread(me)
  )
System(All)=runWith(True,True,
  (||| me:All @ Thread(me))
)
SystemWithSpuriousEvent(All)=runWith(False,True,
  (||| me:All @ Thread(me)) 
)



--Trivial Simple Thread Case
System1=System({T1})
System1WithSpurious=SystemWithSpuriousEvent({T1})
assert Spec1Thread [T= System1 \ {wrongInputFormat}
assert System1 :[deadlock free]

--Two Thread case
--System2=System({T1,T2})
--takes 10-20mins
--assert System2 [T= System2
--assert Spec2Thread [T= System2
